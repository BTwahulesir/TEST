<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Student Quiz - Structural Organisation in Animals</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f6fb;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  box-sizing: border-box;
}
.page-border {
  min-height: 100vh;
  border: 6px solid #1e90ff;
  border-radius: 20px;
  margin: 10px 20px;
  background: white;
  box-shadow: 0 0 35px #a0befd;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 20px;
}
.container {
  width: 95%;
  max-width: 900px;
  display: flex;
  flex-direction: column;
}
label {font-weight: 600; margin: 15px 0 8px; display: block;}
input[type=text], select {
  width: 100%;
  padding: 9px 10px;
  font-size: 1.05em;
  border-radius: 7px;
  border: 1px solid #ccc;
}
#startBtn {
  margin-top: 20px;
  padding: 14px 40px;
  font-size: 1.1em;
  font-weight: 700;
  border-radius: 8px;
  background: #1e90ff;
  color: white;
  border: none;
  cursor: pointer;
}
#startBtn:disabled {background: #a0bbd9; cursor:not-allowed;}
#startBtn:not(:disabled):hover {background: #1970dd;}
#quiz-section {display:none; margin-top: 20px; gap: 25px;}
#progress {text-align:center; margin-bottom: 15px; font-size: 1.1em; color:#555;}
.question-text {font-weight: 700; font-size: 1.3em; margin-bottom: 20px;}
label.option-label {display: block; margin-bottom: 14px; font-size: 1.1em; cursor: pointer;}
input[type=radio] {margin-right: 8px; cursor: pointer;}
.nav-btn {
  padding: 12px 26px;
  border-radius: 8px;
  border:none;
  font-weight: 700;
  font-size: 1.1em;
  margin: 0 10px;
  background: #1e90ff;
  color:white;
}
.nav-btn:hover:not(:disabled) {background:#1970dd;}
.nav-btn:disabled {background: #a0bbd9;}
#submitBtn {margin-top: 22px; padding: 14px 42px; font-weight:700; font-size:1.2em; background:#238823; color:white; border:none; border-radius:9px;}
#submitBtn:disabled {background:#a1cca1;}
#finish-section {display:none; margin-top: 25px;}
.card {
  font-family: 'Poppins', sans-serif;
  width: 460px;
  max-width: 95vw;
  background: white;
  border: 3px solid #1e90ff;
  border-radius: 22px;
  box-shadow: 0 0 18px #7bb9fd;
  padding: 34px 30px;
  text-align: center;
}
.card h1 {font-size: 1.4rem; margin-bottom: 20px; color: #1c416b;}
.trophy {font-size: 2.3rem; margin-bottom: 15px; color: #ffbb1f;}
.details {font-size:1rem; font-weight: 600; color: #444; margin-bottom: 20px;}
.score {font-size: 1.25rem; font-weight:800; margin-bottom: 20px;}
.stats {display: flex; justify-content: space-between; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;}
.stat {flex:1; background:#f5f8fa; border-radius: 10px; padding: 10px; text-align:center;}
.stat-number {width: 44px; height:44px; margin:0 auto 8px; border-radius: 8px; display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.2em;}
.stat.attempted .stat-number {background: #197fd6; color:white;}
.stat.correct   .stat-number {background: #08ad6c; color:white;}
.stat.wrong     .stat-number {background: #d64541; color:white;}
.stat.notattempted .stat-number {background: #ddd; color:#333;}
.footer {font-size: 0.88rem; color:#888;}
#piechart {margin: 10px auto;}
#question-navigator {
  margin-left: 24px;
  width: 210px;
  display: grid;
  grid-template-columns: repeat(5, 36px);
  grid-auto-rows: 36px;
  gap: 10px;
}
.q-nav-btn {
  border-radius: 6px;
  border:none;
  cursor: pointer;
  color:white;
  font-weight: 700;
}
.q-nav-btn.not-attempted {background:#d64541;}
.q-nav-btn.skipped {background:#197fd6;}
.q-nav-btn.attempted {background:#08ad6c;}
.q-nav-btn.current {outline: 2px solid #000;}
table.review-table {width:100%; border-collapse: collapse; margin-top: 15px;}
table.review-table th, table.review-table td {border:1px solid #ccc; padding:6px;}
.correct{color:#08ad6c;font-weight:bold;}
.incorrect{color:#d64541;font-weight:bold;}
.skipped{color:#197fd6;font-weight:bold;}
</style>
</head>
<body>
<div class="page-border">
<div class="container">
  <div id="login-section">
    <label for="rollno">Enter Roll Number (01-200)</label>
    <input type="text" id="rollno" maxlength="3" placeholder="e.g. 01" />
    <label for="batch">Select Batch</label>
    <select id="batch">
      <option value="">-- Select Batch --</option>
      <option value="11th">11th</option>
      <option value="12th">12th</option>
      <option value="NEET Repeater">NEET Repeater</option>
    </select>
    <button id="startBtn" disabled>Start Test</button>
  </div>

  <section id="quiz-section">
    <div style="flex:1">
      <div id="progress"></div>
      <div id="question-block">
        <div class="question-text" id="question-text"></div>
        <form id="options-form"></form>
      </div>
      <div id="navigation">
        <button id="prevBtn" class="nav-btn" disabled>Previous</button>
        <button id="skipBtn" class="nav-btn">Skip</button>
        <button id="nextBtn" class="nav-btn" disabled>Next</button>
      </div>
      <button id="submitBtn" disabled>Submit Test</button>
    </div>
    <nav id="question-navigator"></nav>
  </section>

  <section id="finish-section">
    <div class="card">
      <h1><span class="trophy">&#x1F3C6;</span> Congratulations! Your Test has been Submitted <span class="trophy">&#x1F3C6;</span></h1>
      <div class="details" id="resultDetails"></div>
      <div id="resultScore" class="score"></div>
      <div class="stats">
        <div class="stat attempted"><div class="stat-number" id="attemptedCount">0</div><p>Attempted</p></div>
        <div class="stat correct"><div class="stat-number" id="correctCount">0</div><p>Correct</p></div>
        <div class="stat wrong"><div class="stat-number" id="wrongCount">0</div><p>Wrong</p></div>
        <div class="stat notattempted"><div class="stat-number" id="notAttemptedCount">0</div><p>Not Attempted</p></div>
      </div>
      <canvas id="piechart" width="220" height="220"></canvas>
      <div class="footer">Â© 2025 Vishwajeet Science Academy</div>
    </div>
    <h3>Review your answers:</h3>
    <div id="review-section"></div>
  </section>
</div>
</div>

<script>
const mcqs = [
  // TODO: insert full 60-question objects array here
];

const rollInput=document.getElementById('rollno');
const batchSelect=document.getElementById('batch');
const startBtn=document.getElementById('startBtn');
const quizSection=document.getElementById('quiz-section');
const progressDiv=document.getElementById('progress');
const questionText=document.getElementById('question-text');
const optionsForm=document.getElementById('options-form');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const skipBtn=document.getElementById('skipBtn');
const submitBtn=document.getElementById('submitBtn');
const finishSection=document.getElementById('finish-section');
const resultDetails=document.getElementById('resultDetails');
const resultScore=document.getElementById('resultScore');
const attemptedCount=document.getElementById('attemptedCount');
const correctCount=document.getElementById('correctCount');
const wrongCount=document.getElementById('wrongCount');
const notAttemptedCount=document.getElementById('notAttemptedCount');
const reviewSection=document.getElementById('review-section');
const pieCanvas=document.getElementById('piechart');
const questionNavigator=document.getElementById('question-navigator');

let currentQuestionIndex=0;
let answers=new Array(mcqs.length).fill(undefined);

function validateInput(){
  const roll=parseInt(rollInput.value.trim(),10);
  startBtn.disabled = !(roll>=1 && roll<=200 && batchSelect.value);
}
rollInput.addEventListener('input',()=>{rollInput.value=rollInput.value.replace(/\D/g,'');validateInput();});
batchSelect.addEventListener('change',validateInput);

startBtn.onclick=()=>{
  document.getElementById('login-section').style.display='none';
  quizSection.style.display='flex';
  renderNavigator();
  loadQuestion(0);
};

function renderNavigator(){
  questionNavigator.innerHTML='';
  mcqs.forEach((q,i)=>{
    let btn=document.createElement('button');
    btn.textContent=i+1;
    btn.className='q-nav-btn not-attempted';
    btn.dataset.index=i;
    btn.onclick=()=>loadQuestion(i);
    questionNavigator.appendChild(btn);
  });
}

function updateNavigatorColors(){
  questionNavigator.querySelectorAll('.q-nav-btn').forEach(btn=>{
    const idx=+btn.dataset.index;
    btn.classList.remove('attempted','skipped','not-attempted','current');
    if(idx===currentQuestionIndex) btn.classList.add('current');
    if(answers[idx]===undefined) btn.classList.add('not-attempted');
    else if(answers[idx]===null) btn.classList.add('skipped');
    else btn.classList.add('attempted');
  });
}

function loadQuestion(i){
  currentQuestionIndex=i;
  const q=mcqs[i];
  questionText.textContent=`Q${i+1}. ${q.q}`;
  optionsForm.innerHTML='';
  ['a','b','c','d'].forEach(key=>{
    const lbl=document.createElement('label');
    lbl.className='option-label';
    lbl.innerHTML=`<input type="radio" name="option" value="${key}"> (${key}) ${q[key]}`;
    optionsForm.appendChild(lbl);
  });
  nextBtn.disabled = !answers[i];
  if (answers[i]) optionsForm.querySelector(`input[value="${answers[i]}"]`).checked=true;
  prevBtn.disabled=(i===0);
  progressDiv.textContent=`Question ${i+1} of ${mcqs.length}`;
  updateNavigatorColors();
}

optionsForm.onchange=()=>{nextBtn.disabled=false;};

prevBtn.onclick=()=>{if(currentQuestionIndex>0) loadQuestion(currentQuestionIndex-1);};
nextBtn.onclick=()=>{
  const sel=optionsForm.querySelector('input[name="option"]:checked');
  if(sel) answers[currentQuestionIndex]=sel.value;
  submitBtn.disabled=false;
  if(currentQuestionIndex<mcqs.length-1) loadQuestion(currentQuestionIndex+1);
};
skipBtn.onclick=()=>{
  answers[currentQuestionIndex]=null;
  submitBtn.disabled=false;
  if(currentQuestionIndex<mcqs.length-1) loadQuestion(currentQuestionIndex+1);
};
submitBtn.onclick=()=>{if(confirm('Submit test?')) finalizeTest();};

function finalizeTest(){
  quizSection.style.display='none';
  finishSection.style.display='block';
  const total=mcqs.length;
  const correct=answers.filter((a,i)=>a===mcqs[i].ans).length;
  const wrong=answers.filter((a,i)=>a!==null && a!==undefined && a!==mcqs[i].ans).length;
  const attempted=answers.filter(a=>a!==null && a!==undefined).length;
  const skipped=answers.filter(a=>a===null).length;
  const notAttempted=answers.filter(a=>a===undefined).length;
  const score=correct*4 - wrong;
  const pct=((score/(total*4))*100).toFixed(2);

  resultDetails.innerHTML=`<strong>Roll Number:</strong> ${rollInput.value.padStart(2,'0')}<br><strong>Batch:</strong> ${batchSelect.value}`;
  resultScore.textContent=`Score: ${score} / ${total*4} (${pct}%)`;
  resultScore.style.color = score>=0 ? '#08ad6c' : '#d64541';
  attemptedCount.textContent=attempted;
  correctCount.textContent=correct;
  wrongCount.textContent=wrong;
  notAttemptedCount.textContent=notAttempted;

  drawPieChart(correct, wrong, skipped);
  renderReview();
}

function drawPieChart(c,w,s){
  const ctx=pieCanvas.getContext('2d');
  const total=c+w+s || 1;
  const cx=pieCanvas.width/2, cy=pieCanvas.height/2, r=100;
  ctx.clearRect(0,0,pieCanvas.width,pieCanvas.height);
  let start=-Math.PI/2;
  const slices=[
    {value:c,color:'#08ad6c',label:`Correct (${c})`},
    {value:w,color:'#d64541',label:`Wrong (${w})`},
    {value:s,color:'#197fd6',label:`Skipped (${s})`}
  ];
  slices.forEach(sl=>{
    if(!sl.value) return;
    const ang=(sl.value/total)*2*Math.PI;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start,start+ang);
    ctx.closePath();
    ctx.fillStyle=sl.color;
    ctx.fill();
    start+=ang;
  });
}

function renderReview(){
  let html='<table class="review-table"><thead><tr><th>#</th><th>Question</th><th>Your Answer</th><th>Correct</th><th>Status</th><th>Explanation</th></tr></thead><tbody>';
  mcqs.forEach((q,i)=>{
    const a=answers[i];
    let ya=a===null?'Skipped':a?`(${a}) ${q[a]}`:'Not Attempted';
    let ca=`(${q.ans}) ${q[q.ans]}`;
    let st=a===null?'<span class="skipped">Skipped</span>':(a===q.ans?'<span class="correct">Correct</span>':'<span class="incorrect">Wrong</span>');
    html+=`<tr><td>${i+1}</td><td>${q.q}</td><td>${ya}</td><td>${ca}</td><td>${st}</td><td>${q.expl}</td></tr>`;
  });
  html+='</tbody></table>';
  reviewSection.innerHTML=html;
}
</script>
</body>
</html>
