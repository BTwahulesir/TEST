<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student MCQ Test Dashboard - Structural Organisation in Animals</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f6fb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      min-height: 100vh;
      align-items: flex-start;
      padding-top: 20px;
    }
    .container {
      background: white;
      max-width: 750px;
      width: 95%;
      padding: 25px 30px 30px;
      border-radius: 12px;
      box-shadow: 0 0 25px #c0dbf8;
    }
    h2 {
      color: #254e7b;
      margin-bottom: 15px;
      font-size: 1.6em;
      text-align: center;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }
    input[type="text"], select {
      width: 100%;
      padding: 8px 10px;
      font-size: 1em;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    #startBtn {
      background: #1f71b8;
      border: none;
      color: white;
      padding: 12px 28px;
      font-weight: 700;
      font-size: 1.1em;
      border-radius: 8px;
      cursor: pointer;
      display: block;
      margin: 0 auto 10px auto;
      transition: background-color 0.3s ease;
    }
    #startBtn:hover:not(:disabled) {
      background: #125a9b;
    }
    #startBtn:disabled {
      background: #a2b8d1;
      cursor: not-allowed;
    }
    #quiz-section {
      display: none;
      margin-top: 15px;
    }
    #score {
      font-size: 1.3em;
      font-weight: 700;
      color: #2f7d32;
      margin-bottom: 12px;
      text-align: center;
    }
    #progress {
      color: #666;
      margin-bottom: 20px;
      text-align: center;
    }
    .question-text {
      font-weight: 600;
      font-size: 1.15em;
      margin-bottom: 18px;
    }
    .option-label {
      display: block;
      margin-bottom: 10px;
      cursor: pointer;
      font-size: 1.05em;
    }
    input[type="radio"] {
      margin-right: 10px;
      cursor: pointer;
    }
    #navigation {
      margin-top: 22px;
      text-align: center;
    }
    button.nav-btn {
      background: #1f71b8;
      border: none;
      color: white;
      padding: 11px 22px;
      font-weight: 600;
      border-radius: 7px;
      margin: 0 10px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s ease;
    }
    button.nav-btn:disabled {
      background: #a2b8d1;
      cursor: not-allowed;
    }
    button.nav-btn:hover:not(:disabled) {
      background: #125a9b;
    }
    #submitBtn {
      background: #277b2f;
      margin-top: 25px;
      padding: 14px 32px;
      font-size: 1.2em;
      cursor: pointer;
      display: block;
      margin-left: auto;
      margin-right: auto;
      font-weight: 700;
      border-radius: 8px;
    }
    #submitBtn:disabled {
      background: #94c27a;
      cursor: not-allowed;
    }
    #explanation {
      background: #e2f0d9;
      border-left: 5px solid #4caf50;
      padding: 12px 15px;
      margin-top: 18px;
      font-size: 0.95em;
      display: none;
      line-height: 1.3;
    }
    #finish-section {
      display: none;
      margin-top: 15px;
      text-align: center;
    }
    #summary {
      margin: 18px 0;
      font-size: 1.1em;
      line-height: 1.4em;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    #piechart {
      margin: 20px auto;
      display: block;
      max-width: 350px;
      max-height: 350px;
    }
    table.review-table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 25px;
      font-size: 0.9em;
    }
    table.review-table th,
    table.review-table td {
      border: 1px solid #ccc;
      padding: 8px 9px;
      text-align: left;
    }
    table.review-table th {
      background: #c9deca;
    }
    .correct {
      color: #227629;
      font-weight: 700;
    }
    .incorrect {
      color: #b21d1d;
      font-weight: 700;
    }
    .skipped {
      color: #b28b23;
      font-weight: 700;
    }
    #review-section {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
      border: 1px solid #ccc;
      padding: 10px;
      background: #fdfdfd;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>BIOLOGY TEST 02 - VISHWAJEET SCIENCE ACADEMY</h2>

    <div id="login-section">
      <label for="rollno">Enter Roll Number (01-200):</label>
      <input type="text" id="rollno" maxlength="3" placeholder="e.g. 01" />
      
      <label for="batch">Select Batch:</label>
      <select id="batch">
        <option value="">-- Select Batch --</option>
        <option value="11th">11th</option>
        <option value="12th">12th</option>
        <option value="NEET Repeater">NEET Repeater</option>
      </select>
      
      <button id="startBtn" disabled>Start Test</button>
    </div>

    <section id="quiz-section" aria-live="polite">
      <div id="score">Score: 0</div>
      <div id="progress"></div>

      <div id="question-block">
        <div class="question-text" id="question-text"></div>
        <form id="options-form">
          <!-- radio buttons injected here -->
        </form>
      </div>

      <div id="explanation"></div>

      <div id="navigation">
        <button id="prevBtn" class="nav-btn" disabled>Previous</button>
        <button id="skipBtn" class="nav-btn">Skip</button>
        <button id="nextBtn" class="nav-btn" disabled>Next</button>
      </div>

      <button id="submitBtn" disabled>Submit Test</button>
    </section>

    <section id="finish-section">
      <h3>Congratulation you have successfully Submitted Test!</h3>
      <div id="summary"></div>
      <canvas id="piechart" width="350" height="350" aria-label="Score Distribution Pie Chart"></canvas>
      <h4>Review your answers below:</h4>
      <div id="review-section"></div>
    </section>
  </div>

  <script>
    const mcqs = [   
  // --- Two-statement type: 1-10
  {q:"Statement I: All complex animals are made up of only four basic types of tissues. Statement II: Each type of tissue performs a similar function in all organs.",
   a:"Both statements are correct",b:"Statement I is correct, Statement II is incorrect",c:"Statement I is incorrect, Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"There are only four tissue types, but their roles can vary by organ."},
  {q:"Statement I: Frogs absorb water through their skin. Statement II: Frogs drink water using their mouths.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Frogs absorb moisture via skin and do not drink via mouth."},
  {q:"Statement I: Male frog’s copulatory pad is present on the first digit of the forelimb. Statement II: Female frogs have well-developed vocal sacs.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Only males have pads and vocal sacs."},
  {q:"Statement I: Liver of frog secretes bile. Statement II: Bile helps in breakdown and absorption of proteins.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Bile emulsifies fats, not proteins."},
  {q:"Statement I: The nictitating membrane in frogs protects the eye during swimming. Statement II: Frogs possess external ears like mammals.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Frogs lack external ears, only tympanum present."},
  {q:"Statement I: Villi increase the surface area for absorption in frog’s intestine. Statement II: Villi are present in the stomach.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Villi are found in the small intestine, not the stomach."},
  {q:"Statement I: The circulatory system of frog is closed type. Statement II: Frog’s RBCs are nucleated.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"a",expl:"Both features are correct for frogs."},
  {q:"Statement I: Setae in cockroach legs aid in holding on rough surfaces. Statement II: Arolium in cockroach leg is an adhesive pad.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"a",expl:"Both are locomotory adaptations."},
  {q:"Statement I: Frogs respire only through lungs when on land. Statement II: Cutaneous respiration occurs on land and water.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"c",expl:"On land frogs use lungs and skin."},
  {q:"Statement I: Nephrons are structural units of frog’s kidney. Statement II: Nephrons only filter blood, no reabsorption.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Nephrons also reabsorb water and other substances."},

  // --- Four-statement type: 11-20
  {q:"Which statements are true about muscular tissue? I. Made up of contractile proteins II. Always striated III. Used for movement IV. Only in limbs",
   a:"I, III",b:"II, III",c:"I, II",d:"II, IV",ans:"a",expl:"Smooth muscle is non-striated; muscles also in torso, etc."},
  {q:"Regarding frog’s heart: I. Has three chambers II. Has one ventricle III. Sinus venosus gets oxygenated blood only IV. Covered by pericardium",
   a:"I, II, IV",b:"II, III, IV",c:"I, III, IV",d:"I, II, III",ans:"a",expl:"Sinus venosus receives mixed blood."},
  {q:"Regarding cockroach anatomy: I. Head bears compound eyes II. Abdomen has 10 segments III. Exoskeleton present IV. Antennae from thorax",
   a:"I, II, III",b:"I, II, IV",c:"II, III, IV",d:"I, III, IV",ans:"a",expl:"Antennae arise from head."},
  {q:"Consider connective tissue features: I. Binds structures II. Supports organs III. Forms surfaces IV. Contains matrix",
   a:"I, II, IV",b:"II, III, IV",c:"I, III, IV",d:"I, II, III",ans:"a",expl:"Epithelial forms surfaces."},
  {q:"Frog’s nephron: I. In kidneys II. Opens into ureters III. With Bowman’s capsule IV. For gas exchange",
   a:"I, II, III",b:"II, III, IV",c:"I, III, IV",d:"I, II, IV",ans:"a",expl:"Nephron has no role in gas exchange."},
  {q:"Cockroach exoskeleton: I. Made of chitin II. Sclerites present III. Secreted by epidermis IV. Covers only legs",
   a:"I, II, III",b:"I, III, IV",c:"II, III, IV",d:"I, II, IV",ans:"a",expl:"Covers whole body."},
  {q:"Neural tissue: I. Neurons + neuroglia II. Sends electrical signals III. Only in brain IV. Coordination",
   a:"I, II, IV",b:"II, III, IV",c:"I, III, IV",d:"I, II, III",ans:"a",expl:"Present throughout nervous system."},
  {q:"Frog respiration: I. Only lungs on land II. Skin for cutaneous resp. III. Buccal cavity gas exchange IV. Skin must be moist",
   a:"I, II, III",b:"II, III, IV",c:"I, III, IV",d:"II, IV",ans:"b",expl:"Multiple modes are used on land and in water."},
  {q:"Oviduct in frog: I. Paired II. Opens into cloaca III. Excretory IV. Near kidneys",
   a:"I, II, IV",b:"II, III",c:"I, III",d:"II, IV",ans:"a",expl:"Not an excretory organ."},
  {q:"Cockroach respiration: I. Trachea+spiracles II. Gills used III. Spiracles at intervals IV. Blood not for O2 transport",
   a:"I, III, IV",b:"II, III, IV",c:"I, II, III",d:"I, II, IV",ans:"a",expl:"Cockroach lacks gills; open tracheal system."},

  // --- Assertion Reason: 21-30
  {q:"A: Frog RBCs have nuclei. R: Nucleated RBCs store more oxygen.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Nucleation is primitive; not for O2 storage."},
  {q:"A: Cockroach wings from thorax. R: Both pairs used equally for flight.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Hind wings for flight; forewings protective."},
  {q:"A: Liver is digestive gland. R: Produces pepsin.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Liver makes bile; pepsin from stomach."},
  {q:"A: Frog cutaneous respiration only in hibernation. R: Skin is vascular.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"d",expl:"Occurs in many conditions, not just hibernation."},
  {q:"A: Basement membrane under all epithelium. R: It is non-cellular.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"a",expl:"Supports and separates epithelium from connective tissue."},
  {q:"A: Cockroach legs have plantulae + arolia. R: Help climb smooth surfaces.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"a",expl:"True; these are adhesive structures."},
  {q:"A: Mandibles in cockroach help feeding. R: They also act as antennae.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Mandibles are jaws, antennae are sensory."},
  {q:"A: Frog cloaca is common opening. R: Found only in reptiles.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Also present in amphibians, birds, etc."},
  {q:"A: Connective tissue has more matrix than cells. R: Matrix gives strength.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"a",expl:"Matrix provides support."},
  {q:"A: Cockroach uses Malpighian tubules for excretion. R: They open into the gut.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"a",expl:"This is their location and function."},

  // --- Match the pairs: 31-40
  {q:"Match tissue→feature: A. Epithelium B. Connective C. Muscle D. Nervous 1. Impulse conduction 2. Covers 3. Binding 4. Movement",
   a:"A-2,B-3,C-4,D-1",b:"A-3,B-2,C-1,D-4",c:"A-4,B-1,C-3,D-2",d:"A-1,B-4,C-2,D-3",
   ans:"a",expl:"Epithelial-covers, Connective-binds, Muscle-moves, Nervous-conducts."},
  {q:"Match frog organ→function: A. Liver B. Skin C. Nictitating mem. D. Small intestine 1. Eye protection 2. Bile secretion 3. Absorption 4. Respiration",
   a:"A-2,B-4,C-1,D-3",b:"A-3,B-1,C-2,D-4",c:"A-1,B-2,C-3,D-4",d:"A-4,B-1,C-2,D-3",
   ans:"a",expl:"As per NCERT function mapping."},
  {q:"Cockroach part→function: A. Tegmina B. Malpighian tubules C. Antenna D. Mandibles 1. Excretion 2. Chew 3. Sensory 4. Forewing protect",
   a:"A-4,B-1,C-3,D-2",b:"A-2,B-3,C-1,D-4",c:"A-1,B-2,C-3,D-4",d:"A-4,B-2,C-1,D-3",
   ans:"a",expl:"Functionally matched."},
  {q:"Segment→cockroach structure: A. Prothorax B. Mesothorax C. Metathorax D. Abdomen 1. First wings 2. Last legs 3. Anal cerci 4. First legs",
   a:"A-4,B-1,C-2,D-3",b:"A-2,B-1,C-4,D-3",c:"A-4,B-2,C-1,D-3",d:"A-3,B-1,C-4,D-2",
   ans:"a",expl:"Segmentation details correct."},
  {q:"Frog feature→function: A. Cloaca B. Vasa efferentia C. Buccal cavity D. Maxillary teeth 1. Sperm transfer 2. Common opening 3. Respiration 4. Grasp prey",
   a:"A-2,B-1,C-3,D-4",b:"A-1,B-3,C-2,D-4",c:"A-2,B-4,C-1,D-3",d:"A-3,B-2,C-4,D-1",
   ans:"a",expl:"NCERT matching correct."},
  {q:"Epithelium→function: A. Simple squamous B. Cuboidal C. Columnar D. Ciliated 1. Absorption 2. Diffusion 3. Propulsion 4. Secretion",
   a:"A-2,B-4,C-1,D-3",b:"A-2,B-4,C-3,D-1",c:"A-1,B-2,C-3,D-4",d:"A-4,B-1,C-3,D-2",
   ans:"a",expl:"Functions assigned match cell form."},
  {q:"Earthworm segment→organ: A. 1-3 B. 14-16 C. 17-19 D. 23-25 1. Mouth 2. Clitellum 3. Genital openings 4. Hearts",
   a:"A-1,B-2,C-3,D-4",b:"A-2,B-3,C-4,D-1",c:"A-1,B-2,C-4,D-3",d:"A-3,B-1,C-2,D-4",
   ans:"a",expl:"As per earthworm anatomy."},
  {q:"Cockroach structure→location: A. Anal cerci B. Ocelli C. Maxilla D. Crop 1. Abdomen 2. Head 3. Head 4. Foregut",
   a:"A-1,B-2,C-3,D-4",b:"A-2,B-1,C-3,D-4",c:"A-1,B-2,C-4,D-3",d:"A-3,B-4,C-1,D-2",
   ans:"a",expl:"Locations as per NCERT."},
  {q:"Frog structure→location: A. Tibia-fibula B. Ureter C. Pancreas D. Fat bodies 1. Hindlimb 2. Urogenital 3. Digestive gland 4. Reproductive",
   a:"A-1,B-2,C-3,D-4",b:"A-2,B-1,C-4,D-3",c:"A-4,B-3,C-2,D-1",d:"A-1,B-4,C-3,D-2",
   ans:"a",expl:"Locations/roles correct."},
  {q:"Cockroach system→function: A. Tracheal B. Circulatory C. Digestive D. Nervous 1. Air conduction 2. Open type 3. Enzyme secretion 4. Compound eyes",
   a:"A-1,B-2,C-3,D-4",b:"A-4,B-1,C-2,D-3",c:"A-1,B-3,C-4,D-2",d:"A-3,B-2,C-1,D-4",
   ans:"a",expl:"Matches NCERT details."},
  {q:"Tissue connecting bone to bone",a:"Ligament",b:"Tendon",c:"Cartilage",d:"Adipose",ans:"a",expl:"Ligament joins bones to bones."},
  {q:"Chitinous cuticle is feature of",a:"Earthworm",b:"Frog",c:"Cockroach",d:"Human",ans:"c",expl:"Exoskeleton of arthropods."},
  {q:"Circulatory system in cockroach",a:"Closed",b:"Open without arteries/veins",c:"Closed with arteries",d:"Open with veins only",ans:"b",expl:"Open type, haemocoel present."},
  {q:"Frog heart chambers number",a:"2",b:"3",c:"4",d:"5",ans:"b",expl:"Three-chambered."},
  {q:"Not present in frog’s forelimb",a:"Femur",b:"Radio-ulna",c:"Carpals",d:"Phalanges",ans:"a",expl:"Femur in hindlimb."},
  {q:"Nictitating membrane helps in",a:"Eye protection",b:"Hearing",c:"Excretion",d:"Respiration",ans:"a",expl:"Protects underwater."},
  {q:"Compound eyes present in",a:"Frog",b:"Cockroach",c:"Earthworm",d:"Lizard",ans:"b",expl:"Cockroach, arthropods."},
  {q:"Villi found in frog’s",a:"Kidney",b:"Intestine",c:"Stomach",d:"Skin",ans:"b",expl:"For absorption."},
  {q:"Malpighian tubules open into",a:"Midgut",b:"Hindgut",c:"Foregut",d:"Crop",ans:"b",expl:"At midgut–hindgut junction."},
  {q:"Main excretory organ in frog",a:"Kidney",b:"Malpighian tubule",c:"Lung",d:"Liver",ans:"a",expl:"Kidneys filter waste."},
  {q:"Abdominal segments in male cockroach",a:"9",b:"10",c:"8",d:"11",ans:"b",expl:"Ten segments."},
  {q:"Frog tongue attachment",a:"Anteriorly",b:"Posteriorly",c:"Centre",d:"Unattached",ans:"a",expl:"Anterior for flipping out."},
  {q:"Outermost skin layer is",a:"Epithelial",b:"Muscular",c:"Connective",d:"Nervous",ans:"a",expl:"Epidermal epithelium."},
  {q:"Cilia present on",a:"Ciliated epithelium",b:"Cartilage",c:"Cuboidal",d:"Adipose",ans:"a",expl:"Ciliary motion."},
  {q:"Nerve tissue has",a:"Neurons+glia",b:"RBCs",c:"Osteocytes",d:"Myocytes",ans:"a",expl:"Two cell types."},
  {q:"Sticky pad on cockroach tarsus",a:"Arolium",b:"Cerci",c:"Ocelli",d:"Mandible",ans:"a",expl:"Aids climbing."},
  {q:"Blood cell nucleated in frog",a:"RBC",b:"WBC",c:"Both",d:"Neither",ans:"a",expl:"Amphibian RBC has nucleus."},
  {q:"NOT neural function",a:"Communication",b:"Contraction",c:"Sensory reception",d:"Coordination",ans:"b",expl:"Muscle contract, neuron conduct."},
  {q:"Respiratory surface in hibernating frog",a:"Skin",b:"Lungs",c:"Gills",d:"Mouth",ans:"a",expl:"Cutaneous respiration."},
  {q:"Tissue binding/supporting body",a:"Connective",b:"Muscle",c:"Neural",d:"Epithelial",ans:"a",expl:"Connective supports."}
    ];

    const rollInput = document.getElementById('rollno');
    const batchSelect = document.getElementById('batch');
    const startBtn = document.getElementById('startBtn');

    const quizSection = document.getElementById('quiz-section');
    const scoreDiv = document.getElementById('score');
    const progressDiv = document.getElementById('progress');
    const questionText = document.getElementById('question-text');
    const optionsForm = document.getElementById('options-form');
    const explanationDiv = document.getElementById('explanation');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const skipBtn = document.getElementById('skipBtn');
    const submitBtn = document.getElementById('submitBtn');

    const finishSection = document.getElementById('finish-section');
    const summaryDiv = document.getElementById('summary');
    const pieCanvas = document.getElementById('piechart');
    const reviewSection = document.getElementById('review-section');

    let currentQuestionIndex = 0;
    let answers = new Array(mcqs.length).fill(null); // null = skipped
    let started = false;

    function validateLoginInput() {
      let roll = rollInput.value.trim();
      let batch = batchSelect.value;
      const rollNum = parseInt(roll, 10);
      if (
        roll.length === 0 ||
        isNaN(rollNum) ||
        rollNum < 1 ||
        rollNum > 200 ||
        !batch
      ) {
        startBtn.disabled = true;
      } else {
        startBtn.disabled = false;
      }
    }

    rollInput.addEventListener('input', () => {
      rollInput.value = rollInput.value.replace(/[^0-9]/g, '');
      validateLoginInput();
    });

    batchSelect.addEventListener('change', validateLoginInput);

    startBtn.addEventListener('click', () => {
      started = true;
      document.getElementById('login-section').style.display = 'none';
      quizSection.style.display = 'block';
      loadQuestion();
      updateButtons();
      updateScore();
    });

    function loadQuestion() {
      const q = mcqs[currentQuestionIndex];
      questionText.textContent = `Q${currentQuestionIndex + 1}. ${q.q}`;

      optionsForm.innerHTML = '';
      ['a', 'b', 'c', 'd'].forEach(optionKey => {
        const optionLabel = document.createElement('label');
        optionLabel.classList.add('option-label');
        optionLabel.htmlFor = `option-${optionKey}`;
        optionLabel.innerHTML = `
          <input type="radio" id="option-${optionKey}" name="option" value="${optionKey}" />
          (${optionKey}) ${q[optionKey]}
        `;
        optionsForm.appendChild(optionLabel);
      });

      explanationDiv.style.display = 'none';
      progressDiv.textContent = `Question ${currentQuestionIndex + 1} of ${mcqs.length}`;
      nextBtn.disabled = true;

      const prevAnswer = answers[currentQuestionIndex];
      if (prevAnswer !== null) {
        const prevSelectedRadio = document.getElementById(`option-${prevAnswer}`);
        if (prevSelectedRadio) {
          prevSelectedRadio.checked = true;
          nextBtn.disabled = false;
          explanationDiv.style.display = 'block';
          showExplanationText(currentQuestionIndex);
        }
      }
    }

    function updateScore() {
      const { correctCount, wrongCount } = calculateStats();
      const score = (correctCount * 4) - (wrongCount);
      scoreDiv.textContent = `Score: ${score}`;
    }

    function calculateStats() {
      let correctCount = 0, wrongCount = 0;
      answers.forEach((ans, idx) => {
        if (ans !== null) {
          if (ans === mcqs[idx].ans) correctCount++;
          else wrongCount++;
        }
      });
      return { correctCount, wrongCount };
    }

    function showExplanationText(index) {
      const q = mcqs[index];
      const chosen = answers[index];
      const isCorrect = chosen === q.ans;
      const chosenText = chosen ? q[chosen] : 'No answer selected';
      explanationDiv.innerHTML = `
        <b>Correct Answer:</b> (${q.ans}) ${q[q.ans]}<br />
        <b>Your Answer:</b> ${chosenText}<br />
        <b>Explanation:</b> ${q.expl}<br />
        <span style="color:${isCorrect ? '#228b22' : '#b22222'}; font-weight:bold;">${isCorrect ? '+4 marks' : (chosen ? '-1 mark' : 'Skipped')}</span>
      `;
      explanationDiv.style.display = 'block';
    }

    optionsForm.addEventListener('change', (event) => {
      if (event.target.name === 'option') {
        nextBtn.disabled = false;
      }
    });

    prevBtn.addEventListener('click', () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion();
        updateButtons();
      }
    });

    nextBtn.addEventListener('click', () => {
      const selectedOption = document.querySelector('input[name="option"]:checked');
      if (selectedOption) {
        answers[currentQuestionIndex] = selectedOption.value;
        showExplanationText(currentQuestionIndex);
        updateScore();
      }
      if (currentQuestionIndex < mcqs.length - 1) {
        currentQuestionIndex++;
        loadQuestion();
        updateButtons();
      } else {
        nextBtn.disabled = true;
      }
    });

    skipBtn.addEventListener('click', () => {
      answers[currentQuestionIndex] = null;
      explanationDiv.style.display = 'none';
      updateScore();
      if (currentQuestionIndex < mcqs.length - 1) {
        currentQuestionIndex++;
        loadQuestion();
      }
      updateButtons();
    });

    submitBtn.addEventListener('click', () => {
      if (!confirm('Are you sure you want to submit the test?')) return;
      finalizeTest();
    });

    function updateButtons() {
      prevBtn.disabled = currentQuestionIndex === 0;
      const selectedOption = document.querySelector('input[name="option"]:checked');
      nextBtn.disabled = !selectedOption;
      submitBtn.disabled = false;
    }

    function finalizeTest() {
      quizSection.style.display = 'none';
      finishSection.style.display = 'block';

      const { correctCount, wrongCount } = calculateStats();
      const totalQuestions = mcqs.length;
      const totalScore = (correctCount * 4) - (wrongCount * 1);
      const percentage = ((totalScore / (totalQuestions * 4)) * 100).toFixed(2);
      const attemptedCount = answers.filter(ans => ans !== null).length;
      const skippedCount = answers.filter(ans => ans === null).length;
      const accuracy = attemptedCount === 0 ? 0 : ((correctCount / attemptedCount) * 100).toFixed(2);

      summaryDiv.innerHTML = `
        <p><strong>Roll Number:</strong> ${rollInput.value.padStart(2, '0')}</p>
        <p><strong>Batch:</strong> ${batchSelect.value}</p>
        <p><strong>Total Score:</strong> ${totalScore} out of ${totalQuestions * 4}</p>
        <p><strong>Percentage:</strong> ${percentage}%</p>
        <p><strong>Accuracy (Correct / Attempted):</strong> ${accuracy}%</p>
        <p><strong>Attempted Questions:</strong> ${attemptedCount}</p>
        <p><strong>Skipped Questions:</strong> ${skippedCount}</p>
        <p><strong>Right Answers:</strong> ${correctCount}</p>
        <p><strong>Wrong Answers:</strong> ${wrongCount}</p>
      `;

      drawPieChart(correctCount, wrongCount, skippedCount);
      generateReviewTable();
    }

    function drawPieChart(right, wrong, skipped) {
      const canvas = pieCanvas;
      const ctx = canvas.getContext('2d');
      const total = right + wrong + skipped || 1;
      const cx = canvas.width / 2;
      const cy = canvas.height / 2;
      const radius = Math.min(cx, cy) - 60;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = '16px Arial';
      ctx.textAlign = 'center';

      const slices = [
        { value: right, color: '#4caf50', label: `Right (${right})` },
        { value: wrong, color: '#e53935', label: `Wrong (${wrong})` },
        { value: skipped, color: '#ffb300', label: `Skipped (${skipped})` }
      ];

      let startAngle = -0.5 * Math.PI;
      slices.forEach(slice => {
        if (slice.value === 0) return;
        const sliceAngle = (slice.value / total) * 2 * Math.PI;

        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, radius, startAngle, startAngle + sliceAngle);
        ctx.closePath();
        ctx.fillStyle = slice.color;
        ctx.fill();

        const midAngle = startAngle + sliceAngle / 2;
        const labelX = cx + Math.cos(midAngle) * (radius / 1.5);
        const labelY = cy + Math.sin(midAngle) * (radius / 1.5);

        ctx.fillStyle = '#000';
        ctx.fillText(slice.label, labelX, labelY);

        startAngle += sliceAngle;
      });
    }

    function generateReviewTable() {
      if (answers.length === 0) return;

      let html = '<table class="review-table">';
      html += '<thead><tr><th>Q no.</th><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Status</th></tr></thead><tbody>';
      answers.forEach((ans, i) => {
        const q = mcqs[i];
        let yourAnsText = (ans === null) ? 'Skipped' : `(${ans}) ${q[ans]}`;
        let correctAnsText = `(${q.ans}) ${q[q.ans]}`;
        let status = '';

        if (ans === null) status = '<span class="skipped">Skipped</span>';
        else if (ans === q.ans) status = '<span class="correct">Correct</span>';
        else status = '<span class="incorrect">Wrong</span>';

        html += `<tr>
          <td>${i + 1}</td>
          <td>${q.q}</td>
          <td>${yourAnsText}</td>
          <td>${correctAnsText}</td>
          <td>${status}</td>
        </tr>`;
      });
      html += '</tbody></table>';
      reviewSection.innerHTML = html;
    }

    validateLoginInput();
  </script>
</body>
</html>
