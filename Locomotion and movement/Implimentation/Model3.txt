<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Student MCQ Dashboard - Structural Organisation in Animals</title>
<style>
body{font-family:Arial,sans-serif;background:#f0f6fb;margin:0;padding:0;display:flex;justify-content:center;min-height:100vh;align-items:flex-start;box-sizing:border-box;}
.container{background:#fff;width:85vw;max-width:900px;margin:20px auto;padding:25px;border-radius:12px;box-shadow:0 0 15px #a0bedf;display:flex;flex-direction:column;}
h2{width:100%;color:#254e7b;margin-bottom:15px;font-size:1.8em;text-align:center;}
#login-section{max-width:400px;margin:0 auto 20px;text-align:center;}
label{display:block;font-weight:600;margin:12px 0 6px;}
input[type=text],select{width:100%;padding:8px 10px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box;}
#startBtn{margin-top:15px;padding:12px 30px;font-size:1.1em;font-weight:700;border-radius:8px;border:none;background-color:#1f71b8;color:#fff;cursor:pointer;transition:background-color 0.3s;}
#startBtn:disabled{background-color:#a2b8d1;cursor:not-allowed;}
#startBtn:not(:disabled):hover{background-color:#165b9d;}
#quiz-section{display:none;}
#progress{text-align:center;margin-bottom:20px;color:#555;}
.question-text{font-size:1.2em;font-weight:700;margin-bottom:18px;}
label.option-label{display:block;margin-bottom:12px;font-size:1.05em;cursor:pointer;}
#navigation{text-align:center;margin-top:10px;}
.nav-btn{padding:10px 22px;border-radius:7px;border:none;font-weight:600;font-size:1.05em;margin:0 10px;background-color:#1f71b8;color:white;cursor:pointer;}
.nav-btn:hover:not(:disabled){background-color:#165b9d;}
.nav-btn:disabled{background-color:#a2b8d1;cursor:not-allowed;}
#submitBtn{margin-top:15px;background-color:#277b2f;color:white;font-weight:700;font-size:1.2em;padding:12px 38px;border-radius:8px;cursor:pointer;display:block;margin-left:auto;margin-right:auto;}
#submitBtn:disabled{background-color:#94c27a;cursor:not-allowed;}
#finish-section{display:none;text-align:center;margin-top:15px;}
#piechart{margin:20px auto;max-width:350px;}
table.review-table{border-collapse:collapse;width:100%;margin-top:14px;font-size:0.9em;}
table.review-table th,table.review-table td{border:1px solid #b0b0b0;padding:6px 10px;text-align:left;}
table.review-table th{background-color:#c8e6c9;}
.correct{color:#2e7d32;font-weight:700;}
.incorrect{color:#c62828;font-weight:700;}
.skipped{color:#ef6c00;font-weight:700;}
#review-section{max-height:300px;overflow-y:auto;margin-top:15px;border:1px solid #ccc;padding:10px;background:#fafafa;border-radius:6px;}
#question-navigator{display:grid;grid-template-columns:repeat(5, 1fr);gap:8px;justify-items:center;}
.q-nav-btn{width:30px;height:30px;border-radius:50%;font-weight:700;font-size:1em;border:none;cursor:pointer;color:white;box-shadow:0 0 5px rgba(0,0,0,0.3);}
.q-nav-btn.not-attempted{background-color:#c62828;}
.q-nav-btn.skipped{background-color:#1976d2;}
.q-nav-btn.attempted{background-color:#2e7d32;}
.q-nav-btn.current{outline:3px solid #000;transform:scale(1.3);}
</style>
</head>
<body>
<div class="container">
  <h2>BIOLOGY TEST - VISHWAJEET SCIENCE ACADEMY</h2>

  <!-- Login -->
  <div id="login-section">
    <label for="rollno">Enter Roll Number (01-200)</label>
    <input type="text" id="rollno" maxlength="3" placeholder="e.g. 01" autocomplete="off" />
    <label for="batch">Select Batch</label>
    <select id="batch">
      <option value="">-- Select Batch --</option>
      <option value="11th">11th</option>
      <option value="12th">12th</option>
      <option value="NEET Repeater">NEET Repeater</option>
    </select>
    <button id="startBtn" disabled>Start Test</button>
  </div>

  <!-- Quiz -->
  <section id="quiz-section">
    <div style="display:flex;gap:20px;">
      <div style="flex:1;">
        <!-- Removed Score Display -->
        <div id="progress"></div>
        <div id="question-block">
          <div class="question-text" id="question-text"></div>
          <form id="options-form"></form>
        </div>
        <div id="navigation">
          <button id="prevBtn" class="nav-btn" disabled>Previous</button>
          <button id="skipBtn" class="nav-btn">Skip</button>
          <button id="nextBtn" class="nav-btn" disabled>Next</button>
        </div>
        <button id="submitBtn" disabled>Submit Test</button>
      </div>
      <div id="question-navigator"></div>
    </div>
  </section>

  <!-- Finish -->
  <section id="finish-section">
    <h3>Test Submitted!</h3>
    <div id="summary"></div>
    <canvas id="piechart" width="350" height="350"></canvas>
    <h4>Review your answers below:</h4>
    <div id="review-section"></div>
  </section>
</div>

<script>
/* Insert the full 60-question mcqs array from earlier here */
const mcqs = [  
  // --- Two-statement type: 1-10
  {q:"Statement I: All complex animals are made up of only four basic types of tissues. Statement II: Each type of tissue performs a similar function in all organs.",
   a:"Both statements are correct",b:"Statement I is correct, Statement II is incorrect",c:"Statement I is incorrect, Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"There are only four tissue types, but their roles can vary by organ."},
  {q:"Statement I: Frogs absorb water through their skin. Statement II: Frogs drink water using their mouths.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Frogs absorb moisture via skin and do not drink via mouth."},
  {q:"Statement I: Male frog’s copulatory pad is present on the first digit of the forelimb. Statement II: Female frogs have well-developed vocal sacs.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Only males have pads and vocal sacs."},
  {q:"Statement I: Liver of frog secretes bile. Statement II: Bile helps in breakdown and absorption of proteins.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Bile emulsifies fats, not proteins."},
  {q:"Statement I: The nictitating membrane in frogs protects the eye during swimming. Statement II: Frogs possess external ears like mammals.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Frogs lack external ears, only tympanum present."},
  {q:"Statement I: Villi increase the surface area for absorption in frog’s intestine. Statement II: Villi are present in the stomach.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Villi are found in the small intestine, not the stomach."},
  {q:"Statement I: The circulatory system of frog is closed type. Statement II: Frog’s RBCs are nucleated.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"a",expl:"Both features are correct for frogs."},
  {q:"Statement I: Setae in cockroach legs aid in holding on rough surfaces. Statement II: Arolium in cockroach leg is an adhesive pad.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"a",expl:"Both are locomotory adaptations."},
  {q:"Statement I: Frogs respire only through lungs when on land. Statement II: Cutaneous respiration occurs on land and water.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"c",expl:"On land frogs use lungs and skin."},
  {q:"Statement I: Nephrons are structural units of frog’s kidney. Statement II: Nephrons only filter blood, no reabsorption.",
   a:"Both statements are correct",b:"Only Statement I is correct",c:"Only Statement II is correct",d:"Both statements are incorrect",
   ans:"b",expl:"Nephrons also reabsorb water and other substances."},

  // --- Four-statement type: 11-20
  {q:"Which statements are true about muscular tissue? I. Made up of contractile proteins II. Always striated III. Used for movement IV. Only in limbs",
   a:"I, III",b:"II, III",c:"I, II",d:"II, IV",ans:"a",expl:"Smooth muscle is non-striated; muscles also in torso, etc."},
  {q:"Regarding frog’s heart: I. Has three chambers II. Has one ventricle III. Sinus venosus gets oxygenated blood only IV. Covered by pericardium",
   a:"I, II, IV",b:"II, III, IV",c:"I, III, IV",d:"I, II, III",ans:"a",expl:"Sinus venosus receives mixed blood."},
  {q:"Regarding cockroach anatomy: I. Head bears compound eyes II. Abdomen has 10 segments III. Exoskeleton present IV. Antennae from thorax",
   a:"I, II, III",b:"I, II, IV",c:"II, III, IV",d:"I, III, IV",ans:"a",expl:"Antennae arise from head."},
  {q:"Consider connective tissue features: I. Binds structures II. Supports organs III. Forms surfaces IV. Contains matrix",
   a:"I, II, IV",b:"II, III, IV",c:"I, III, IV",d:"I, II, III",ans:"a",expl:"Epithelial forms surfaces."},
  {q:"Frog’s nephron: I. In kidneys II. Opens into ureters III. With Bowman’s capsule IV. For gas exchange",
   a:"I, II, III",b:"II, III, IV",c:"I, III, IV",d:"I, II, IV",ans:"a",expl:"Nephron has no role in gas exchange."},
  {q:"Cockroach exoskeleton: I. Made of chitin II. Sclerites present III. Secreted by epidermis IV. Covers only legs",
   a:"I, II, III",b:"I, III, IV",c:"II, III, IV",d:"I, II, IV",ans:"a",expl:"Covers whole body."},
  {q:"Neural tissue: I. Neurons + neuroglia II. Sends electrical signals III. Only in brain IV. Coordination",
   a:"I, II, IV",b:"II, III, IV",c:"I, III, IV",d:"I, II, III",ans:"a",expl:"Present throughout nervous system."},
  {q:"Frog respiration: I. Only lungs on land II. Skin for cutaneous resp. III. Buccal cavity gas exchange IV. Skin must be moist",
   a:"I, II, III",b:"II, III, IV",c:"I, III, IV",d:"II, IV",ans:"b",expl:"Multiple modes are used on land and in water."},
  {q:"Oviduct in frog: I. Paired II. Opens into cloaca III. Excretory IV. Near kidneys",
   a:"I, II, IV",b:"II, III",c:"I, III",d:"II, IV",ans:"a",expl:"Not an excretory organ."},
  {q:"Cockroach respiration: I. Trachea+spiracles II. Gills used III. Spiracles at intervals IV. Blood not for O2 transport",
   a:"I, III, IV",b:"II, III, IV",c:"I, II, III",d:"I, II, IV",ans:"a",expl:"Cockroach lacks gills; open tracheal system."},

  // --- Assertion Reason: 21-30
  {q:"A: Frog RBCs have nuclei. R: Nucleated RBCs store more oxygen.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Nucleation is primitive; not for O2 storage."},
  {q:"A: Cockroach wings from thorax. R: Both pairs used equally for flight.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Hind wings for flight; forewings protective."},
  {q:"A: Liver is digestive gland. R: Produces pepsin.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Liver makes bile; pepsin from stomach."},
  {q:"A: Frog cutaneous respiration only in hibernation. R: Skin is vascular.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"d",expl:"Occurs in many conditions, not just hibernation."},
  {q:"A: Basement membrane under all epithelium. R: It is non-cellular.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"a",expl:"Supports and separates epithelium from connective tissue."},
  {q:"A: Cockroach legs have plantulae + arolia. R: Help climb smooth surfaces.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"a",expl:"True; these are adhesive structures."},
  {q:"A: Mandibles in cockroach help feeding. R: They also act as antennae.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Mandibles are jaws, antennae are sensory."},
  {q:"A: Frog cloaca is common opening. R: Found only in reptiles.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"c",expl:"Also present in amphibians, birds, etc."},
  {q:"A: Connective tissue has more matrix than cells. R: Matrix gives strength.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"a",expl:"Matrix provides support."},
  {q:"A: Cockroach uses Malpighian tubules for excretion. R: They open into the gut.",
   a:"Both true, R explains A",b:"Both true, R not expl",c:"A true, R false",d:"Both false",
   ans:"a",expl:"This is their location and function."},

  // --- Match the pairs: 31-40
  {q:"Match tissue→feature: A. Epithelium B. Connective C. Muscle D. Nervous 1. Impulse conduction 2. Covers 3. Binding 4. Movement",
   a:"A-2,B-3,C-4,D-1",b:"A-3,B-2,C-1,D-4",c:"A-4,B-1,C-3,D-2",d:"A-1,B-4,C-2,D-3",
   ans:"a",expl:"Epithelial-covers, Connective-binds, Muscle-moves, Nervous-conducts."},
  {q:"Match frog organ→function: A. Liver B. Skin C. Nictitating mem. D. Small intestine 1. Eye protection 2. Bile secretion 3. Absorption 4. Respiration",
   a:"A-2,B-4,C-1,D-3",b:"A-3,B-1,C-2,D-4",c:"A-1,B-2,C-3,D-4",d:"A-4,B-1,C-2,D-3",
   ans:"a",expl:"As per NCERT function mapping."},
  {q:"Cockroach part→function: A. Tegmina B. Malpighian tubules C. Antenna D. Mandibles 1. Excretion 2. Chew 3. Sensory 4. Forewing protect",
   a:"A-4,B-1,C-3,D-2",b:"A-2,B-3,C-1,D-4",c:"A-1,B-2,C-3,D-4",d:"A-4,B-2,C-1,D-3",
   ans:"a",expl:"Functionally matched."},
  {q:"Segment→cockroach structure: A. Prothorax B. Mesothorax C. Metathorax D. Abdomen 1. First wings 2. Last legs 3. Anal cerci 4. First legs",
   a:"A-4,B-1,C-2,D-3",b:"A-2,B-1,C-4,D-3",c:"A-4,B-2,C-1,D-3",d:"A-3,B-1,C-4,D-2",
   ans:"a",expl:"Segmentation details correct."},
  {q:"Frog feature→function: A. Cloaca B. Vasa efferentia C. Buccal cavity D. Maxillary teeth 1. Sperm transfer 2. Common opening 3. Respiration 4. Grasp prey",
   a:"A-2,B-1,C-3,D-4",b:"A-1,B-3,C-2,D-4",c:"A-2,B-4,C-1,D-3",d:"A-3,B-2,C-4,D-1",
   ans:"a",expl:"NCERT matching correct."},
  {q:"Epithelium→function: A. Simple squamous B. Cuboidal C. Columnar D. Ciliated 1. Absorption 2. Diffusion 3. Propulsion 4. Secretion",
   a:"A-2,B-4,C-1,D-3",b:"A-2,B-4,C-3,D-1",c:"A-1,B-2,C-3,D-4",d:"A-4,B-1,C-3,D-2",
   ans:"a",expl:"Functions assigned match cell form."},
  {q:"Earthworm segment→organ: A. 1-3 B. 14-16 C. 17-19 D. 23-25 1. Mouth 2. Clitellum 3. Genital openings 4. Hearts",
   a:"A-1,B-2,C-3,D-4",b:"A-2,B-3,C-4,D-1",c:"A-1,B-2,C-4,D-3",d:"A-3,B-1,C-2,D-4",
   ans:"a",expl:"As per earthworm anatomy."},
  {q:"Cockroach structure→location: A. Anal cerci B. Ocelli C. Maxilla D. Crop 1. Abdomen 2. Head 3. Head 4. Foregut",
   a:"A-1,B-2,C-3,D-4",b:"A-2,B-1,C-3,D-4",c:"A-1,B-2,C-4,D-3",d:"A-3,B-4,C-1,D-2",
   ans:"a",expl:"Locations as per NCERT."},
  {q:"Frog structure→location: A. Tibia-fibula B. Ureter C. Pancreas D. Fat bodies 1. Hindlimb 2. Urogenital 3. Digestive gland 4. Reproductive",
   a:"A-1,B-2,C-3,D-4",b:"A-2,B-1,C-4,D-3",c:"A-4,B-3,C-2,D-1",d:"A-1,B-4,C-3,D-2",
   ans:"a",expl:"Locations/roles correct."},
  {q:"Cockroach system→function: A. Tracheal B. Circulatory C. Digestive D. Nervous 1. Air conduction 2. Open type 3. Enzyme secretion 4. Compound eyes",
   a:"A-1,B-2,C-3,D-4",b:"A-4,B-1,C-2,D-3",c:"A-1,B-3,C-4,D-2",d:"A-3,B-2,C-1,D-4",
   ans:"a",expl:"Matches NCERT details."},
  {q:"Tissue connecting bone to bone",a:"Ligament",b:"Tendon",c:"Cartilage",d:"Adipose",ans:"a",expl:"Ligament joins bones to bones."},
  {q:"Chitinous cuticle is feature of",a:"Earthworm",b:"Frog",c:"Cockroach",d:"Human",ans:"c",expl:"Exoskeleton of arthropods."},
  {q:"Circulatory system in cockroach",a:"Closed",b:"Open without arteries/veins",c:"Closed with arteries",d:"Open with veins only",ans:"b",expl:"Open type, haemocoel present."},
  {q:"Frog heart chambers number",a:"2",b:"3",c:"4",d:"5",ans:"b",expl:"Three-chambered."},
  {q:"Not present in frog’s forelimb",a:"Femur",b:"Radio-ulna",c:"Carpals",d:"Phalanges",ans:"a",expl:"Femur in hindlimb."},
  {q:"Nictitating membrane helps in",a:"Eye protection",b:"Hearing",c:"Excretion",d:"Respiration",ans:"a",expl:"Protects underwater."},
  {q:"Compound eyes present in",a:"Frog",b:"Cockroach",c:"Earthworm",d:"Lizard",ans:"b",expl:"Cockroach, arthropods."},
  {q:"Villi found in frog’s",a:"Kidney",b:"Intestine",c:"Stomach",d:"Skin",ans:"b",expl:"For absorption."},
  {q:"Malpighian tubules open into",a:"Midgut",b:"Hindgut",c:"Foregut",d:"Crop",ans:"b",expl:"At midgut–hindgut junction."},
  {q:"Main excretory organ in frog",a:"Kidney",b:"Malpighian tubule",c:"Lung",d:"Liver",ans:"a",expl:"Kidneys filter waste."},
  {q:"Abdominal segments in male cockroach",a:"9",b:"10",c:"8",d:"11",ans:"b",expl:"Ten segments."},
  {q:"Frog tongue attachment",a:"Anteriorly",b:"Posteriorly",c:"Centre",d:"Unattached",ans:"a",expl:"Anterior for flipping out."},
  {q:"Outermost skin layer is",a:"Epithelial",b:"Muscular",c:"Connective",d:"Nervous",ans:"a",expl:"Epidermal epithelium."},
  {q:"Cilia present on",a:"Ciliated epithelium",b:"Cartilage",c:"Cuboidal",d:"Adipose",ans:"a",expl:"Ciliary motion."},
  {q:"Nerve tissue has",a:"Neurons+glia",b:"RBCs",c:"Osteocytes",d:"Myocytes",ans:"a",expl:"Two cell types."},
  {q:"Sticky pad on cockroach tarsus",a:"Arolium",b:"Cerci",c:"Ocelli",d:"Mandible",ans:"a",expl:"Aids climbing."},
  {q:"Blood cell nucleated in frog",a:"RBC",b:"WBC",c:"Both",d:"Neither",ans:"a",expl:"Amphibian RBC has nucleus."},
  {q:"NOT neural function",a:"Communication",b:"Contraction",c:"Sensory reception",d:"Coordination",ans:"b",expl:"Muscle contract, neuron conduct."},
  {q:"Respiratory surface in hibernating frog",a:"Skin",b:"Lungs",c:"Gills",d:"Mouth",ans:"a",expl:"Cutaneous respiration."},
  {q:"Tissue binding/supporting body",a:"Connective",b:"Muscle",c:"Neural",d:"Epithelial",ans:"a",expl:"Connective supports."}
];

let currentQuestionIndex=0;
let answers=new Array(mcqs.length).fill(undefined);
const rollInput=document.getElementById('rollno'), batchSelect=document.getElementById('batch'), startBtn=document.getElementById('startBtn');
const quizSection=document.getElementById('quiz-section'), progressDiv=document.getElementById('progress');
const questionText=document.getElementById('question-text'), optionsForm=document.getElementById('options-form');
const prevBtn=document.getElementById('prevBtn'), nextBtn=document.getElementById('nextBtn'), skipBtn=document.getElementById('skipBtn'), submitBtn=document.getElementById('submitBtn');
const finishSection=document.getElementById('finish-section'), summaryDiv=document.getElementById('summary'), pieCanvas=document.getElementById('piechart'), reviewSection=document.getElementById('review-section');
const questionNavigator=document.getElementById('question-navigator');

function validateLoginInput(){
  const r=parseInt(rollInput.value.trim(),10);
  startBtn.disabled=!(r>=1 && r<=200 && batchSelect.value);
}
rollInput.addEventListener('input',()=>{rollInput.value=rollInput.value.replace(/\D/g,'');validateLoginInput();});
batchSelect.addEventListener('change',validateLoginInput);

startBtn.addEventListener('click',()=>{
  document.getElementById('login-section').style.display='none';
  quizSection.style.display='block';
  renderNavigator();
  loadQuestion(0);
});

function renderNavigator(){
  questionNavigator.innerHTML='';
  for(let i=0;i<mcqs.length;i++){
    const btn=document.createElement('button');
    btn.textContent=i+1;
    btn.className='q-nav-btn not-attempted';
    btn.dataset.index=i;
    btn.onclick=()=>loadQuestion(i);
    questionNavigator.appendChild(btn);
  }
}

function loadQuestion(i){
  currentQuestionIndex=i;
  const q=mcqs[i];
  questionText.textContent=`Q${i+1}. ${q.q}`;
  optionsForm.innerHTML='';
  ['a','b','c','d'].forEach(k=>{
    const lbl=document.createElement('label');
    lbl.className='option-label';
    lbl.innerHTML=`<input type="radio" name="option" value="${k}"> (${k}) ${q[k]}`;
    optionsForm.appendChild(lbl);
  });
  const prev=answers[i];
  if(prev){ optionsForm.querySelector(`input[value="${prev}"]`).checked=true; nextBtn.disabled=false; } else { nextBtn.disabled=true; }
  progressDiv.textContent=`Question ${i+1} of ${mcqs.length}`;
  prevBtn.disabled=(i===0);
  updateNavigatorColors();
}

optionsForm.addEventListener('change',()=>{nextBtn.disabled=false;});

prevBtn.onclick=()=>{if(currentQuestionIndex>0) loadQuestion(currentQuestionIndex-1);};
nextBtn.onclick=()=>{
  const sel=optionsForm.querySelector('input[name="option"]:checked');
  if(sel) answers[currentQuestionIndex]=sel.value;
  if(currentQuestionIndex<mcqs.length-1) loadQuestion(currentQuestionIndex+1);
  submitBtn.disabled=false;
};
skipBtn.onclick=()=>{answers[currentQuestionIndex]=null;if(currentQuestionIndex<mcqs.length-1) loadQuestion(currentQuestionIndex+1);submitBtn.disabled=false;};
submitBtn.onclick=()=>{if(confirm('Submit test?')) finalizeTest();};

function updateNavigatorColors(){
  questionNavigator.querySelectorAll('.q-nav-btn').forEach(btn=>{
    btn.classList.remove('attempted','skipped','not-attempted','current');
    const idx=+btn.dataset.index;
    if(idx===currentQuestionIndex) btn.classList.add('current');
    if(answers[idx]===undefined) btn.classList.add('not-attempted');
    else if(answers[idx]===null) btn.classList.add('skipped');
    else btn.classList.add('attempted');
  });
}

function finalizeTest(){
  quizSection.style.display='none';finishSection.style.display='block';
  const total=mcqs.length, correct=answers.filter((a,i)=>a===mcqs[i].ans).length, wrong=answers.filter((a,i)=>a && a!==mcqs[i].ans).length, skipped=answers.filter(a=>a===null).length;
  const score=correct*4-wrong, pct=((score/(total*4))*100).toFixed(2), attempt=total-skipped, acc=attempt?((correct/attempt)*100).toFixed(2):0;
  summaryDiv.innerHTML=`<p>Roll Number: ${rollInput.value}</p><p>Batch: ${batchSelect.value}</p><p>Score: ${score} / ${total*4} (${pct}%)</p><p>Attempted: ${attempt}</p><p>Skipped: ${skipped}</p><p>Correct: ${correct}</p><p>Wrong: ${wrong}</p>`;
  drawPieChart(correct,wrong,skipped);
  showReview();
}

function drawPieChart(c,w,s){
  const ctx=pieCanvas.getContext('2d'), total=c+w+s||1, cx=175,cy=175,radius=100;
  ctx.clearRect(0,0,350,350);
  const slices=[{v:c,cl:'#4caf50',t:`Correct (${c})`},{v:w,cl:'#e53935',t:`Wrong (${w})`},{v:s,cl:'#1976d2',t:`Skipped (${s})`}];
  let start=-Math.PI/2;
  slices.forEach(sl=>{if(!sl.v)return;const ang=(sl.v/total)*Math.PI*2;ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,radius,start,start+ang);ctx.closePath();ctx.fillStyle=sl.cl;ctx.fill();start+=ang;});
}

function showReview(){
  let html='<table class="review-table"><tr><th>#</th><th>Question</th><th>Your Answer</th><th>Correct</th><th>Status</th><th>Explanation</th></tr>';
  mcqs.forEach((q,i)=>{
    let ya=answers[i]===null?'Skipped':answers[i]?`(${answers[i]}) ${q[answers[i]]}`:'Not attempted';
    let ca=`(${q.ans}) ${q[q.ans]}`;
    let st=answers[i]===null?'<span class="skipped">Skipped</span>':answers[i]===q.ans?'<span class="correct">Correct</span>':'<span class="incorrect">Wrong</span>';
    html+=`<tr><td>${i+1}</td><td>${q.q}</td><td>${ya}</td><td>${ca}</td><td>${st}</td><td>${q.expl}</td></tr>`;
  });
  html+='</table>';reviewSection.innerHTML=html;
}
</script>
</body>
</html>
