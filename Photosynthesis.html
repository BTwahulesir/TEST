
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vishwajeet Science Academy</title>
  <style>
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: #f4f7fc;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .page-border {
      min-height: 100vh;
      border: 6px solid #1e90ff;
      border-radius: 20px;
      margin: 0;
      background: white;
      box-shadow: 0 0 35px #a0befd;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px 0;
    }
    .container {
      width: 97%;
      max-width: 950px;
      margin: auto;
      display: flex;
      flex-direction: column;
    }
    h2.main-title {
      text-align: center;
      margin-bottom: 12px;
      font-size: 2.65rem;
      color: #E2008A;
      font-weight: 800;
    }
    .logo-img {
      display: block;
      margin: 0 auto 18px auto;
      max-width: 160px;
      width: 100%;
      height: auto;
      border-radius: 50%;
      box-shadow: 0 0 14px #a0befd;
      border: 3px solid #1e90ff;
      background: #fff;
    }
    .sub-title {
      text-align: center;
      font-size: 2.1rem;
      margin: 0 0 28px 0;
      font-family: 'cambria', serif, cursive;
      color: #047020;
      font-weight: 700;
      letter-spacing: 1px;
    }
    h4.special-author {
      text-align: center;
      /* Unique styling for author heading */
      font-family: 'Pacifico', 'Brush Script MT', cursive, sans-serif;
      font-size: 2rem;
      color: #6316D7;
      font-weight: 600;
      letter-spacing: 3px;
      font-style: italic;
      margin-top: 3px;
      margin-bottom: 28px;
    }
    label { font-weight:600; margin:14px 0 7px; display:block; }
    input[type=text], select {
      width:100%;
      padding:10px 12px;
      font-size:1.04em;
      border-radius:7px;
      border:1.4px solid #bbb;
      background:#f9f9fb;
    }
    #startBtn {
      margin-top:20px;
      padding:14px 40px;
      font-size:1.12em;
      font-weight:700;
      border-radius:8px;
      background:#1e90ff;
      color:white;
      border:none;
      cursor:pointer;
    }
    #startBtn:disabled { background:#a0bbd9; cursor:not-allowed; }
    #startBtn:not(:disabled):hover { background:#1970dd; }
    #quiz-section { display:none; margin-top:22px; gap:25px; }
    #progress { text-align:center; margin-bottom:16px; font-size:1.1em; color:#555; }
    .question-text { font-weight:700; font-size:1.22em; margin-bottom:17px; }
    .options { margin-bottom:25px; }
    .options label.option-label {
      display:flex; align-items:center; gap:13px;
      background:#f9f9f9;
      border:2px solid #eaeaea;
      border-radius:9px;
      margin-bottom:14px;
      font-size:1.08em;
      font-weight:500;
      cursor:pointer;
      transition:all 0.18s;
      min-height:48px;
      padding:0 20px;
    }
    .options label.option-label:hover {
      border:2px solid #1976d2;
      background:#f0f9ff;
      box-shadow:0 2px 8px #1976d215;
    }
    .options input[type="radio"] {
      accent-color:#1976d2;
      appearance:none;
      width:22px; height:22px;
      border:2px solid #bbb;
      border-radius:50%;
      background:#fff;
      margin-right:10px;
    }
    .options input[type="radio"]:checked {
      border:7px solid #1976d2;
      background:#f3f8fd;
    }
    .options label.option-label.selected {
      border:2.5px solid #1976d2;
      background:#eef6fb;
    }
    .options .option-letter {
      font-weight:700;
      color:#1976d2;
      font-size:1.13em;
      padding-right:10px;
    }
    #navigation { text-align:center; margin-top:12px; }
    .nav-btn {
      padding:12px 26px;
      border-radius:8px;
      border:none;
      font-weight:700;
      font-size:1.1em;
      margin:0 10px;
      background:#1976d2;
      color:white;
    }
    .nav-btn:hover:not(:disabled) { background:#065ab1; }
    .nav-btn:disabled { background:#b9cce1; }
    #submitBtn {
      margin-top:22px;
      padding:14px 42px;
      font-weight:700;
      font-size:1.2em;
      background:#238823;
      color:white;
      border:none;
      border-radius:9px;
    }
    #submitBtn:disabled { background:#a8d1b7; }
    #finish-section { display:none; margin-top:25px; }
    .card {
      width:470px;
      max-width:96vw;
      background:white;
      border:3px solid #1e90ff;
      border-radius:22px;
      box-shadow:0 0 18px #7bb9fd;
      padding:30px 20px;
      text-align:center;
      margin:0 auto;
    }
    .card h1 { font-size:1.4rem; margin-bottom:20px; color:#1c416b; }
    .trophy { font-size:2.3rem; margin-bottom:15px; color:#ffbb1f; }
    .details { font-size:1rem; font-weight:600; color:#444; margin-bottom:20px; }
    .score { font-size:1.25rem; font-weight:800; margin-bottom:20px; }
    .stats {
      display:flex; justify-content:center; gap:10px;
      flex-wrap:wrap; margin-bottom:20px;
    }
    .stat { flex:1; background:#f5f8fa; border-radius:10px; padding:10px; text-align:center; min-width:80px; }
    .stat-number {
      width:44px; height:44px; margin:0 auto 8px;
      border-radius:8px; display:flex; align-items:center;
      justify-content:center; font-weight:700; font-size:1.2em;
    }
    .stat.attempted .stat-number { background:#197fd6; color:white; }
    .stat.correct .stat-number { background:#08ad6c; color:white; }
    .stat.wrong .stat-number { background:#d64541; color:white; }
    .stat.notattempted .stat-number { background:#ddd; color:#333; }
    #question-navigator {
      margin-left:24px; width:210px;
      display:grid; grid-template-columns:repeat(5,36px);
      grid-auto-rows:36px; gap:10px;
    }
    .q-nav-btn { border-radius:6px; border:none; cursor:pointer; color:white; font-weight:700; }
    .q-nav-btn.not-attempted { background:#d64541; }
    .q-nav-btn.skipped { background:#197fd6; }
    .q-nav-btn.attempted { background:#08ad6c; }
    .q-nav-btn.current { outline:2px solid #000; }
    table.review-table {
      width:100%; border-collapse:collapse; margin-top:15px;
    }
    table.review-table th, table.review-table td {
      border:1px solid #ccc; padding:6px;
    }
    .correct{color:#08ad6c;font-weight:bold;}
    .incorrect{color:#d64541;font-weight:bold;}
    .skipped{color:#1976d2;font-weight:bold;}
    .export-btns {
      margin:22px auto 0 auto;
      display:flex; gap:15px; flex-wrap:wrap;
      justify-content:center;
    }
  </style>
  <!-- Pacifico font for enhanced author style -->
  <link href="https://fonts.googleapis.com/css?family=Pacifico&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
<div class="page-border">
  <div class="container">
    <h2 class="main-title">VISHWAJEET SCIENCE ACADEMY</h2>
    <img src="Vsa logo.JPEG" alt="VSA logo" class="logo-img"></img>
    <h3 class="sub-title">BIOLOGY: Animal Kingdom</h3>
    <h4 class="special-author">&copy; By WAHULE SIR</h4>
    <div id="login-section">
      <label for="rollno">Enter Roll Number (01-200)</label>
      <input type="text" id="rollno" maxlength="3" placeholder="e.g. 01" />
      <label for="batch">Select Batch</label>
      <select id="batch">
        <option value="">-- Select Batch --</option>
        <option value="11th">11th</option>
        <option value="12th">12th</option>
        <option value="NEET Repeater">NEET Repeater</option>
      </select>
      <button id="startBtn" disabled>Start Test</button>
    </div>
    <section id="quiz-section">
      <div style="flex:1">
        <div id="progress"></div>
        <div id="question-block">
          <div class="question-text" id="question-text"></div>
          <form id="options-form" class="options"></form>
        </div>
        <div id="navigation">
          <button id="prevBtn" class="nav-btn" disabled>Previous</button>
          <button id="skipBtn" class="nav-btn">Skip</button>
          <button id="nextBtn" class="nav-btn" disabled>Next</button>
        </div>
        <button id="submitBtn" disabled>Submit Test</button>
      </div>
      <nav id="question-navigator"></nav>
    </section>
    <section id="finish-section">
      <div style="display:flex; flex-direction:column; align-items:center;">
        <div class="card">
          <h1><span class="trophy">&#x1F3C6;</span> Congratulations! Your Test has been Submitted <span class="trophy">&#x1F3C6;</span></h1>
          <div class="details" id="resultDetails"></div>
          <div id="resultScore" class="score"></div>
          <div class="stats">
            <div class="stat attempted"><div class="stat-number" id="attemptedCount">0</div><p>Attempted</p></div>
            <div class="stat correct"><div class="stat-number" id="correctCount">0</div><p>Correct</p></div>
            <div class="stat wrong"><div class="stat-number" id="wrongCount">0</div><p>Wrong</p></div>
            <div class="stat notattempted"><div class="stat-number" id="notAttemptedCount">0</div><p>Not Attempted</p></div>
          </div>
          <canvas id="piechart" width="220" height="220"></canvas>
          <div class="footer">¬© 2025 Vishwajeet Science Academy</div>
        </div>
        <div class="export-btns">
          <button class="nav-btn" id="printBtn" type="button">üñ®Ô∏è Print Report</button>
          <button class="nav-btn" id="pdfBtn" type="button">‚¨áÔ∏è Download PDF</button>
          <button class="nav-btn" id="excelBtn" type="button">‚¨áÔ∏è Export to Excel</button>
        </div>
      </div>
      <h2 id="review-heading" style="margin-top:36px;">Review Your Answers</h2>
      <div id="review-section"></div>
    </section>
  </div>
</div>
<script>
const mcqs = [
  { 
    q: "Where does photosynthesis mainly occur?",
    a: "Mitochondria",
    b: "Chloroplast",
    c: "Cytoplasm",
    d: "Nucleus",
    ans: "b",
    expl: "Chloroplast is the site containing chlorophyll for photosynthesis as per NCERT."
  },
  {
    q: "Which pigment is the primary light-absorbing molecule?",
    a: "Chlorophyll a",
    b: "Carotenoids",
    c: "Xanthophyll",
    d: "Chlorophyll b",
    ans: "a",
    expl: "Chlorophyll a absorbs light for photochemistry and is the primary pigment."
  },
  {
    q: "First stable product of CO2 fixation in C3 plants?",
    a: "Phosphoglyceric acid",
    b: "Malic acid",
    c: "Oxaloacetic acid",
    d: "Ribulose bisphosphate",
    ans: "a",
    expl: "Phosphoglyceric acid (PGA) is the first stable product in the Calvin cycle."
  },
  {
    q: "Oxygen released during photosynthesis originates from?",
    a: "CO2",
    b: "Water",
    c: "Glucose",
    d: "Atmospheric oxygen",
    ans: "b",
    expl: "Oxygen is released from the photolysis of water molecules."
  },
  {
    q: "Where do light-independent reactions occur?",
    a: "Grana",
    b: "Stroma",
    c: "Thylakoid membrane",
    d: "Cytoplasm",
    ans: "b",
    expl: "Calvin cycle occurs in the stroma region of chloroplasts."
  },
  {
    q: "Which enzyme fixes CO2 in Calvin cycle?",
    a: "Rubisco",
    b: "PEP carboxylase",
    c: "ATP synthase",
    d: "NADP reductase",
    ans: "a",
    expl: "Rubisco catalyzes the fixation of CO2 on RuBP in Calvin cycle."
  },
  {
    q: "Cyclic photophosphorylation produces:",
    a: "ATP only",
    b: "NADPH only",
    c: "ATP and NADPH",
    d: "Oxygen",
    ans: "a",
    expl: "In cyclic photophosphorylation, only ATP is produced."
  },
  {
    q: "Light-dependent reaction releases:",
    a: "CO2",
    b: "ATP and NADPH",
    c: "Glucose",
    d: "RuBP",
    ans: "b",
    expl: "Light reactions produce ATP, NADPH and oxygen."
  },
  {
    q: "Photosystem I reaction center absorbs light at:",
    a: "680 nm",
    b: "700 nm",
    c: "400 nm",
    d: "500 nm",
    ans: "b",
    expl: "PS I has reaction center P700 which absorbs at 700 nm."
  },
  {
    q: "Which color is least absorbed by chlorophyll?",
    a: "Red",
    b: "Blue",
    c: "Green",
    d: "Violet",
    ans: "c",
    expl: "Green light is mostly reflected, which is why plants appear green."
  },
  {
    q: "Water is split during which photosystem?",
    a: "PSI",
    b: "PSII",
    c: "Both",
    d: "None",
    ans: "b",
    expl: "Photolysis of water occurs during Photosystem II."
  },
  {
    q: "The molecule that finally accepts electrons in non-cyclic photophosphorylation:",
    a: "NADP+",
    b: "ADP",
    c: "Oxygen",
    d: "Glucose",
    ans: "a",
    expl: "NADP+ accepts electrons and gets reduced to NADPH."
  },
  {
    q: "Which is NOT a product of light reaction?",
    a: "Oxygen",
    b: "ATP",
    c: "NADPH",
    d: "Glucose",
    ans: "d",
    expl: "Glucose is produced in the Calvin cycle (dark reaction), not light reaction."
  },
  {
    q: "Excessive light harms photosynthesis because:",
    a: "It breaks down chlorophyll",
    b: "Plants use more water",
    c: "It increases oxygen",
    d: "No effect",
    ans: "a",
    expl: "Excess light causes photo-oxidation damaging chlorophyll pigments."
  },
  {
    q: "Photorespiration results in:",
    a: "Glucose formation",
    b: "CO2 release",
    c: "Oxygen fixation",
    d: "ATP synthesis",
    ans: "b",
    expl: "Photorespiration wastes energy and releases CO2 reducing photosynthetic efficiency."
  },
  {
    q: "Light reaction occurs in:",
    a: "Cytoplasm",
    b: "Stroma",
    c: "Thylakoid membrane",
    d: "Chloroplast envelope",
    ans: "c",
    expl: "Light-dependent reactions take place in thylakoid membranes."
  },
  {
    q: "The enzyme producing ATP during photophosphorylation is:",
    a: "Rubisco",
    b: "ATP synthase",
    c: "NADP reductase",
    d: "PEP carboxylase",
    ans: "b",
    expl: "ATP synthase uses proton gradient to produce ATP."
  },
  {
    q: "Calvin cycle requires which molecules?",
    a: "ATP and NADPH",
    b: "Oxygen and ATP",
    c: "Glucose and water",
    d: "NADP+ only",
    ans: "a",
    expl: "ATP and NADPH from light reactions supply energy and reducing power."
  },
  {
    q: "Which is an accessory pigment?",
    a: "Chlorophyll a",
    b: "Chlorophyll b",
    c: "Both (a) and (b)",
    d: "Xanthophyll",
    ans: "d",
    expl: "Xanthophylls protect chlorophyll and broaden spectrum of light absorbed."
  },
  {
    q: "The enzyme involved in reduction of PGA in Calvin cycle is:",
    a: "ATP synthase",
    b: "Phosphoglyceraldehyde dehydrogenase",
    c: "Rubisco",
    d: "NADP reductase",
    ans: "b",
    expl: "Phosphoglyceraldehyde dehydrogenase reduces PGA to PGAL."
  },

  // Medium difficulty MCQs start here
  {
    q: "Assertion: PEP carboxylase has no oxygenase activity. Reason: It prevents photorespiration in C4 plants.",
    a: "Both true; Reason explains Assertion",
    b: "Both true; Reason does not explain Assertion",
    c: "Assertion true; Reason false",
    d: "Assertion false; Reason true",
    ans: "a",
    expl: "PEP carboxylase efficiently fixes CO2 without binding oxygen, reducing photorespiration."
  },
  {
    q: "Kranz anatomy is typical for:",
    a: "C3 plants",
    b: "C4 plants",
    c: "CAM plants",
    d: "Algae",
    ans: "b",
    expl: "Kranz anatomy is characteristic of C4 plants to spatially separate steps."
  },
  {
    q: "Red drop phenomenon indicates:",
    a: "Photosynthesis falls sharply beyond 680 nm",
    b: "Photosynthesis peaks at 400 nm",
    c: "No absorption of light",
    d: "Increased oxygen output",
    ans: "a",
    expl: "Photosynthetic efficiency decreases beyond red wavelength of 680 nm."
  },
  {
    q: "Photorespiration occurs in:",
    a: "Chloroplast, mitochondria, peroxisomes",
    b: "Golgi apparatus",
    c: "Thylakoid membrane",
    d: "Cytoplasm",
    ans: "a",
    expl: "Photorespiration involves these organelles in metabolizing glycolate."
  },
  {
    q: "C4 pathway initial CO2 acceptor is:",
    a: "RuBP",
    b: "Malic acid",
    c: "PEP",
    d: "Oxaloacetate",
    ans: "c",
    expl: "Phosphoenolpyruvate (PEP) carboxylase fixes CO2 first in C4 pathway."
  },
  {
    q: "Calvin cycle enzyme for carbon fixation is:",
    a: "Rubisco",
    b: "ATP synthase",
    c: "NADPH reductase",
    d: "PEP carboxylase",
    ans: "a",
    expl: "Rubisco catalyzes carbon fixation in Calvin cycle."
  },
  {
    q: "Increasing CO2 concentration beyond a point:",
    a: "Increases photosynthesis infinitely",
    b: "Saturates rate",
    c: "Decreases photosynthesis",
    d: "Has no effect",
    ans: "b",
    expl: "Photosynthesis rate saturates due to limiting factors other than CO2."
  },
  {
    q: "Increasing temperature beyond optimum causes:",
    a: "Increased enzyme activity",
    b: "Enzyme denaturation",
    c: "Enhanced glucose synthesis",
    d: "Reduced light absorption",
    ans: "b",
    expl: "High temperature denatures enzymes reducing photosynthesis rate."
  },
  {
    q: "Accessory pigment in light harvesting complex is:",
    a: "Chlorophyll a",
    b: "Carotenoids",
    c: "Rubisco",
    d: "ATP synthase",
    ans: "b",
    expl: "Carotenoids absorb light wavelengths that chlorophyll cannot."
  },
  {
    q: "ATP synthesis in chloroplast occurs by:",
    a: "Substrate level phosphorylation",
    b: "Photophosphorylation",
    c: "Oxidative phosphorylation",
    d: "None",
    ans: "b",
    expl: "Photophosphorylation generates ATP using light energy."
  },

  // Hard difficulty MCQs start here
  {
    q: "The enzyme phosphoglycolate phosphatase is involved in:",
    a: "Calvin cycle",
    b: "Glycolate pathway of photorespiration",
    c: "Electron transport",
    d: "Light reaction",
    ans: "b",
    expl: "Phosphoglycolate phosphatase acts in photorespiratory metabolism."
  },
  {
    q: "The product formed when CO2 reacts with PEP in C4 plants is:",
    a: "Oxaloacetate",
    b: "Malate",
    c: "Glycolate",
    d: "Phosphoglycolate",
    ans: "a",
    expl: "Oxaloacetate is the first product in C4 carbon fixation by PEP carboxylase."
  },
  {
    q: "Cyclic and non-cyclic photophosphorylation differ mainly by:",
    a: "Electrons cycling back",
    b: "ATP generation only",
    c: "NADPH production",
    d: "Both a and c",
    ans: "d",
    expl: "Cyclic produces only ATP; non-cyclic produces both ATP and NADPH."
  },
  {
    q: "Which enzyme catalyzes the regeneration of RuBP in Calvin cycle?",
    a: "Rubisco",
    b: "Transketolase",
    c: "Fructose bisphosphatase",
    d: "PEP carboxylase",
    ans: "b",
    expl: "Transketolase helps regenerate RuBP during Calvin cycle."
  },
  {
    q: "Limiting factor law was given by:",
    a: "Calvin",
    b: "Blackman",
    c: "Engelmann",
    d: "Priestley",
    ans: "b",
    expl: "Blackman formulated the law of limiting factors in photosynthesis."
  },
  {
    q: "Which compound transports electrons from PSII to PSI?",
    a: "Ferredoxin",
    b: "Plastoquinone",
    c: "Plastocyanin",
    d: "ATP synthase",
    ans: "b",
    expl: "Plastoquinone carries electrons between Photosystem II and I."
  },
  {
    q: "Photooxidation damages:",
    a: "Rubisco",
    b: "Thylakoid membrane",
    c: "Chlorophyll",
    d: "NADP+",
    ans: "c",
    expl: "Photooxidation harms chlorophyll pigments under excess light."
  },
  {
    q: "Main function of NADPH in photosynthesis is:",
    a: "ATP generation",
    b: "Carbon fixation",
    c: "Electron donor for reduction",
    d: "Oxygen production",
    ans: "c",
    expl: "NADPH donates electrons to reduce 3-PGA to PGAL."
  },
  {
    q: "In CAM plants, CO2 fixation occurs:",
    a: "Daytime only",
    b: "Nighttime only",
    c: "Both day and night",
    d: "No fixation",
    ans: "b",
    expl: "CAM plants fix CO2 at night to minimize water loss."
  },
  {
    q: "The photophosphorylation type linked with oxygen evolution is:",
    a: "Cyclic",
    b: "Non-cyclic",
    c: "Both",
    d: "None",
    ans: "b",
    expl: "Non-cyclic photophosphorylation involves water splitting and O2 release."
  },
  {
    q: "RuBisCO oxygenase activity leads to:",
    a: "Glucose synthesis",
    b: "Photorespiration",
    c: "Photophosphorylation",
    d: "Electron transport",
    ans: "b",
    expl: "Oxygenase activity causes photorespiration which wastes energy."
  },
  {
    q: "The process of ATP formation using proton gradient is called:",
    a: "Substrate level phosphorylation",
    b: "Oxidative phosphorylation",
    c: "Chemiosmosis",
    d: "Phosphorylation",
    ans: "c",
    expl: "Chemiosmosis synthesizes ATP from proton motive force."
  },
  {
    q: "The enzyme RuBisCO is considered the most abundant due to:",
    a: "Its role in nitrogen fixation",
    b: "Its quantity in plants worldwide",
    c: "Its thermodynamic stability",
    d: "Catalyzing photolysis",
    ans: "b",
    expl: "RuBisCO is abundant as it plays a central role in CO2 fixation."
  },
  {
    q: "The enzyme phosphoglycerate kinase catalyzes:",
    a: "Conversion of PGA to PGAL",
    b: "ATP formation in light reaction",
    c: "PGA phosphorylation to bisphosphoglycerate",
    d: "RuBP regeneration",
    ans: "c",
    expl: "It converts PGA into 1,3-bisphosphoglycerate during Calvin cycle."
  },
  {
    q: "Which process involves mitochondria and peroxisomes along with chloroplasts?",
    a: "Photooxidation",
    b: "Photorespiration",
    c: "Calvin cycle",
    d: "Light reaction",
    ans: "b",
    expl: "Photorespiration involves multiple organelles to metabolize glycolate."
  },
  {
    q: "The rate of CO2 fixation in C4 plants is higher due to:",
    a: "Higher Rubisco amounts",
    b: "Spatial separation of steps",
    c: "More activity of ATP synthase",
    d: "Less oxygen",
    ans: "b",
    expl: "Separation reduces photorespiration improving fixation rate."
  },
  {
    q: "Which pigment forms two types of reaction centers, P700 and P680?",
    a: "Chlorophyll b",
    b: "Chlorophyll a",
    c: "Carotene",
    d: "Xanthophyll",
    ans: "b",
    expl: "Chlorophyll a is present in both PS I (P700) and PS II (P680)."
  },
  {
    q: "The molecule that directly reduces NADP+ in light reaction is:",
    a: "Ferredoxin",
    b: "Plastocyanin",
    c: "Plastoquinone",
    d: "Cytochrome b6f",
    ans: "a",
    expl: "Ferredoxin transfers electrons to NADP+ reductase."
  },
  {
    q: "The major limiting factor under natural conditions for photosynthesis is:",
    a: "Light intensity",
    b: "CO2 concentration",
    c: "Water availability",
    d: "Temperature",
    ans: "b",
    expl: "CO2 concentration is often limiting photosynthesis rate outdoors."
  },
  {
    q: "Which enzyme is responsible for fructose bisphosphate synthesis in Calvin cycle?",
    a: "Fructose bisphosphatase",
    b: "Hexokinase",
    c: "Rubisco",
    d: "Transketolase",
    ans: "a",
    expl: "Fructose bisphosphatase catalyzes fructose bisphosphate formation."
  }
];
const rollInput=document.getElementById('rollno');
const batchSelect=document.getElementById('batch');
const startBtn=document.getElementById('startBtn');
const quizSection=document.getElementById('quiz-section');
const progressDiv=document.getElementById('progress');
const questionText=document.getElementById('question-text');
const optionsForm=document.getElementById('options-form');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const skipBtn=document.getElementById('skipBtn');
const submitBtn=document.getElementById('submitBtn');
const finishSection=document.getElementById('finish-section');
const resultDetails=document.getElementById('resultDetails');
const resultScore=document.getElementById('resultScore');
const attemptedCount=document.getElementById('attemptedCount');
const correctCount=document.getElementById('correctCount');
const wrongCount=document.getElementById('wrongCount');
const notAttemptedCount=document.getElementById('notAttemptedCount');
const reviewSection=document.getElementById('review-section');
const pieCanvas=document.getElementById('piechart');
const questionNavigator=document.getElementById('question-navigator');
let currentQuestionIndex=0;
let answers=new Array(mcqs.length).fill(undefined);
function validateInput(){
  const roll=parseInt(rollInput.value.trim(),10);
  startBtn.disabled=!(roll>=1 && roll<=200 && batchSelect.value);
}
rollInput.addEventListener('input',()=>{rollInput.value=rollInput.value.replace(/\D/g,'');validateInput();});
batchSelect.addEventListener('change',validateInput);
startBtn.onclick=()=>{ document.getElementById('login-section').style.display='none'; quizSection.style.display='flex'; renderNavigator(); loadQuestion(0); };
function renderNavigator(){
  questionNavigator.innerHTML='';
  mcqs.forEach((q,i)=>{
    let btn=document.createElement('button');
    btn.textContent=i+1;
    btn.className='q-nav-btn not-attempted';
    btn.dataset.index=i;
    btn.onclick=()=>loadQuestion(i);
    questionNavigator.appendChild(btn);
  });
}
function updateNavigatorColors(){
  questionNavigator.querySelectorAll('.q-nav-btn').forEach(btn=>{
    const idx=+btn.dataset.index;
    btn.classList.remove('attempted','skipped','not-attempted','current');
    if(idx===currentQuestionIndex) btn.classList.add('current');
    if(answers[idx]===undefined) btn.classList.add('not-attempted');
    else if(answers[idx]===null) btn.classList.add('skipped');
    else btn.classList.add('attempted');
  });
}
function loadQuestion(i){
  currentQuestionIndex=i;
  const q=mcqs[i];
  questionText.textContent=`Q${i+1}. ${q.q}`;
  optionsForm.innerHTML='';
  ['a','b','c','d'].forEach(key=>{
    const lbl=document.createElement('label');
    lbl.className='option-label';
    lbl.innerHTML=`<input type="radio" name="option" value="${key}"><span class="option-letter">(${key.toUpperCase()})</span>${q[key]}`;
    optionsForm.appendChild(lbl);
  });
  optionsForm.querySelectorAll('input[type="radio"]').forEach(radio=>{
    radio.addEventListener('change',()=>{
      optionsForm.querySelectorAll('label.option-label').forEach(lbl=>lbl.classList.remove('selected'));
      radio.closest('label').classList.add('selected');
      nextBtn.disabled=false;
    });
  });
  if (answers[i]) {
    const sel=optionsForm.querySelector(`input[value="${answers[i]}"]`);
    if(sel){ sel.checked=true; sel.closest('label').classList.add('selected'); nextBtn.disabled=false; }
    else { nextBtn.disabled=true;}
  } else { nextBtn.disabled=true; }
  prevBtn.disabled=(i===0);
  progressDiv.textContent=`Question ${i+1} of ${mcqs.length}`;
  updateNavigatorColors();
}
prevBtn.onclick=()=>{ if(currentQuestionIndex>0) loadQuestion(currentQuestionIndex-1); };
nextBtn.onclick=()=>{ const sel=optionsForm.querySelector('input[name="option"]:checked'); if(sel) answers[currentQuestionIndex]=sel.value; submitBtn.disabled=false; if(currentQuestionIndex<mcqs.length-1) loadQuestion(currentQuestionIndex+1); };
skipBtn.onclick=()=>{ answers[currentQuestionIndex]=null; submitBtn.disabled=false; if(currentQuestionIndex<mcqs.length-1) loadQuestion(currentQuestionIndex+1); };
submitBtn.onclick=()=>{ if(confirm('Submit test?')) finalizeTest(); };
function finalizeTest(){
  quizSection.style.display='none';
  finishSection.style.display='block';
  const total = mcqs.length;
  const correct = answers.filter((a,i)=>a === mcqs[i].ans).length;
  const wrong = answers.filter((a,i)=>a !== null && a !== undefined && a !== mcqs[i].ans).length;
  const attempted = answers.filter(a=>a !== null && a !== undefined).length;
  const skipped = answers.filter(a=>a === null).length;
  const notAttempted = answers.filter(a=>a === undefined).length;
  const score = correct*4 - wrong;
  const pct = ((score/(total*4))*100).toFixed(2);
  resultDetails.innerHTML=`<strong>Roll Number:</strong> ${rollInput.value.padStart(2,'0')}<br><strong>Batch:</strong> ${batchSelect.value}`;
  resultScore.textContent=`Score: ${score} / ${total*4} (${pct}%)`;
  resultScore.style.color=score>=0 ? '#08ad6c' : '#d64541';
  attemptedCount.textContent=attempted;
  correctCount.textContent=correct;
  wrongCount.textContent=wrong;
  notAttemptedCount.textContent=notAttempted;
  drawPieChart(correct, wrong, skipped);
  renderReview();
}
function drawPieChart(c,w,s){
  const ctx=pieCanvas.getContext('2d');
  const total=c+w+s || 1; const cx=110, cy=110, r=100;
  ctx.clearRect(0,0,pieCanvas.width,pieCanvas.height);
  let start=-Math.PI/2;
  const slices=[{v:c,col:'#08ad6c'},{v:w,col:'#d64541'},{v:s,col:'#197fd6'}];
  slices.forEach(sl=>{ if(!sl.v) return; const ang=(sl.v/total)*2*Math.PI; ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,start,start+ang); ctx.closePath(); ctx.fillStyle=sl.col; ctx.fill(); start+=ang; });
}
function renderReview(){
  let html='<table class="review-table"><thead><tr><th>#</th><th>Question</th><th>Your Answer</th><th>Correct</th><th>Status</th><th>Explanation</th></tr></thead><tbody>';
  mcqs.forEach((q,i)=>{
    const a = answers[i];
    const yourAns=(a===null)?'Skipped':(a!==undefined)?`(${a}) ${q[a]}`:'Not Attempted';
    const correctAns=`(${q.ans}) ${q[q.ans]}`;
    const status=(a===null)?'<span class="skipped">Skipped</span>':(a===q.ans)?'<span class="correct">Correct</span>':'<span class="incorrect">Wrong</span>';
    html+=`<tr><td>${i+1}</td><td>${q.q}</td><td>${yourAns}</td><td>${correctAns}</td><td>${status}</td><td>${q.expl}</td></tr>`;
  });
  html+='</tbody></table>'; reviewSection.innerHTML=html;
}
document.getElementById("printBtn").onclick=()=>{
  const fs=document.getElementById('finish-section');
  let original=document.body.innerHTML;
  document.body.innerHTML=fs.innerHTML;
  window.print();
  document.body.innerHTML=original;
  location.reload();
};
document.getElementById("pdfBtn").onclick=()=>{
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  doc.setFontSize(15);
  doc.text("BIOLOGY TEST - VISHWAJEET SCIENCE ACADEMY",105,16,{align:"center"});
  doc.setFontSize(10);
  doc.text(resultDetails.innerText,14,26);
  doc.text(resultScore.innerText,14,32);
  doc.autoTable({html:"#review-section table",startY:40,theme:"grid",headStyles:{fillColor:[30,144,255]}});
  doc.save("Biology_Test_Result.pdf");
};
document.getElementById("excelBtn").onclick=()=>{
  let table=document.querySelector("#review-section table");
  if(!table){alert("No review table.");return;}
  let html=table.outerHTML.replace(/ /g,"%20");
  let blob=new Blob([html],{type:'application/vnd.ms-excel'});
  let link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="Biology_Test_Result.xls";
  link.click();
  setTimeout(()=>URL.revokeObjectURL(link.href),1000);
};
</script>
</body>
</html>
